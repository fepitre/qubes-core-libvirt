From 55ee7b247355029aa674b7040cc2cdfd5330cf7f Mon Sep 17 00:00:00 2001
From: HW42 <hw42@ipsumj.de>
Date: Fri, 29 Sep 2017 05:56:55 +0200
Subject: [PATCH] libxl: add basic PVHv2 support
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Marek Marczykowski-GÃ³recki <marmarek@invisiblethingslab.com>
---
 docs/schemas/domaincommon.rng | 2 ++
 src/conf/domain_conf.c        | 3 ++-
 src/conf/domain_conf.h        | 1 +
 src/libxl/libxl_conf.c        | 2 ++
 4 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/docs/schemas/domaincommon.rng b/docs/schemas/domaincommon.rng
index 71e2210503..b84d830153 100644
--- a/docs/schemas/domaincommon.rng
+++ b/docs/schemas/domaincommon.rng
@@ -3093,6 +3093,7 @@
                 <value>qemu</value>
                 <value>stubdom</value>
                 <value>stubdom-linux</value>
+                <value>none</value>
               </choice>
             </attribute>
           </optional>
@@ -3114,6 +3115,7 @@
               <value>qemu</value>
               <value>stubdom</value>
               <value>stubdom-linux</value>
+              <value>none</value>
             </choice>
           </attribute>
           <optional>
diff --git a/src/conf/domain_conf.c b/src/conf/domain_conf.c
index 5123f0eafe..61c6488098 100644
--- a/src/conf/domain_conf.c
+++ b/src/conf/domain_conf.c
@@ -866,7 +866,8 @@ VIR_ENUM_IMPL(virDomainDiskTray, VIR_DOMAIN_DISK_TRAY_LAST,
 VIR_ENUM_IMPL(virDomainEmulatorType, VIR_DOMAIN_EMULATOR_TYPE_LAST,
               "qemu",
               "stubdom",
-              "stubdom-linux");
+              "stubdom-linux",
+              "none");
 
 VIR_ENUM_IMPL(virDomainRNGModel,
               VIR_DOMAIN_RNG_MODEL_LAST,
diff --git a/src/conf/domain_conf.h b/src/conf/domain_conf.h
index c3a062afb3..ee77cf06f2 100644
--- a/src/conf/domain_conf.h
+++ b/src/conf/domain_conf.h
@@ -2109,6 +2109,7 @@ typedef enum {
     VIR_DOMAIN_EMULATOR_TYPE_DEFAULT,
     VIR_DOMAIN_EMULATOR_TYPE_STUBDOM,
     VIR_DOMAIN_EMULATOR_TYPE_STUBDOM_LINUX,
+    VIR_DOMAIN_EMULATOR_TYPE_NONE,
 
     VIR_DOMAIN_EMULATOR_TYPE_LAST
 } virDomainEmulatorType;
diff --git a/src/libxl/libxl_conf.c b/src/libxl/libxl_conf.c
index 28d5258dea..10ba6d9995 100644
--- a/src/libxl/libxl_conf.c
+++ b/src/libxl/libxl_conf.c
@@ -549,6 +549,8 @@ libxlMakeDomBuildInfo(virDomainDefPtr def,
                 b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_QEMU_XEN_TRADITIONAL;
             else if (def->emulator_type == VIR_DOMAIN_EMULATOR_TYPE_STUBDOM_LINUX)
                 b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_QEMU_XEN;
+            else if (def->emulator_type == VIR_DOMAIN_EMULATOR_TYPE_NONE)
+                b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_NONE;
         }
 
         /* In case of stubdom there will be two qemu instances:
-- 
2.17.1

